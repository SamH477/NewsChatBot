<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Speech Recognition</title>
   <style>
        body, html {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 0;
        }

        .container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .button {
            background-color: blue;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 12px;
            margin-right: 10px;
        }

        .button:hover {
            background-color: white; 
            color: black;
            border: 2px solid blue;
        }
        #response, #userSaid, #chatbotResponse {
            margin: 10px 0;
        }
    </style>
</head>
<body>
   <h1>Speech Recognition Chat Bot</h1>

   <div class=""container">
        <button id="startListening" class="button">Start Listening</button>
        <button id="stopListening" class="button">Stop Listening</button>
   </div>
   <div id="response"></div>
   <div id="userSaid"></div>
   <div id="chatbotResponse"></div>

   <script>
       let listening = false; // Flag to track if we are currently listening
       let today = new Date();
       let str_today = today.getFullYear() + '-' + (today.getMonth() + 1).toString().padStart(2, '0') + '-' + today.getDate().toString().padStart(2, '0');

       let time = new Date();
       let str_time = time.toLocaleString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });

       let commands = ["hello", "what's the date", "what time is it"];
       let responses = {"hello": "Hi! How can I help you?", "what's the date": str_today, "what time is it": str_time};

       const api_config = {
           api_key: ''
       };

       document.getElementById('startListening').addEventListener('click', function() {
           document.getElementById('response').innerText = "Listening...";
           document.getElementById('userSaid').innerText = "";
           document.getElementById('chatbotResponse').innerText = "";
           listening = true; // Set listening to true
           recognition.start();
       });

       document.getElementById('stopListening').addEventListener('click', function() {
           document.getElementById('response').innerText = "Goodbye";
           document.getElementById('userSaid').innerText = "";
           document.getElementById('chatbotResponse').innerText = "";
           listening = false; // Set listening to false
           recognition.stop();
       });

       let recognition = new webkitSpeechRecognition();
       recognition.onresult = function(event) {
        if(listening == true){
           let transcript = event.results[0][0].transcript;
           document.getElementById('userSaid').innerText = "You said: " + transcript;
           
           for (let cmds of commands) {
                if (cmds === transcript) {
                    document.getElementById('chatbotResponse').innerText = "Response from chatbot: " + responses[cmds];
                    document.getElementById('response').innerText = "";

                }
            }

            if(transcript == "goodbye"){
                document.getElementById('chatbotResponse').innerText = "Response from chatbot: Goodbye";
                document.getElementById('response').innerText = "";
                listening = false;

                recognition.stop();
            }

            if (transcript == "what's the news") {
                document.getElementById('response').innerText = "";
                    
                try {

                    const apiUrl = `http://api.mediastack.com/v1/news?access_key=${api_config.api_key}`;

                    fetch(apiUrl)
                        .then(response => {
                            if (response.status === 200) {
                                return response.json();
                            } else {
                                throw new Error('Network response was not ok');
                            }
                        })
                        .then(data => {
                            if ("data" in data) {
                                const news_articles = data.data;
                                if (news_articles.length > 0) {
                                    let news_info = "<ul>";
                                    news_articles.forEach(article => {
                                        const title = article.title || "No Title";
                                        const source = article.source || "Unknown Source";
                                       const url = article.url || "No URL";
                                        news_info += `<li><a href='${url}' target='_blank'>${title}</a> from ${source}</li>`;
                                    });
                                    news_info += "</ul>";
                                    const message = `Here's the latest news: ${news_info}`;
                                    document.getElementById('chatbotResponse').innerHTML = message;
                                    
                                } else {
                                    document.getElementById('chatbotResponse').innerText="No news articles found.";
                                }
                            } else {
                                document.getElementById('chatbotResponse').innerText="No 'data' field in the response";
                            }
                        })
                        .catch(error => console.error('Error:', error));
                } catch (error) {
                    document.getElementById('chatbotResponse').innerText=`chatbot: An error occurred: ${error}`;
                }        
            }

            if (transcript == "what's the sports news") {
                document.getElementById('response').innerText = "";
                    
                try {

                    const apiUrl = `http://api.mediastack.com/v1/news?access_key=${api_config.api_key}&categories=sports`;
                
                    fetch(apiUrl)
                        .then(response => {
                            if (response.status === 200) {
                                return response.json();
                            } else {
                                throw new Error('Network response was not ok');
                            }
                        })
                        .then(data => {
                            if ("data" in data) {
                                const news_articles = data.data;
                                if (news_articles.length > 0) {
                                    let news_info = "<ul>";
                                    news_articles.forEach(article => {
                                        const title = article.title || "No Title";
                                        const source = article.source || "Unknown Source";
                                       const url = article.url || "No URL";
                                        news_info += `<li><a href='${url}' target='_blank'>${title}</a> from ${source}</li>`;
                                    });
                                    news_info += "</ul>";
                                    const message = `Here's the latest sports news: ${news_info}`;
                                    document.getElementById('chatbotResponse').innerHTML = message;
                                    
                                } else {
                                    document.getElementById('chatbotResponse').innerText="No news articles found.";
                                }
                            } else {
                                document.getElementById('chatbotResponse').innerText="No 'data' field in the response";
                            }
                        })
                        .catch(error => console.error('Error:', error));
                } catch (error) {
                    document.getElementById('chatbotResponse').innerText=`chatbot: An error occurred: ${error}`;
                }        
            }

            if(document.getElementById('chatbotResponse').innerText == ""){
                document.getElementById('response').innerText = "";

                document.getElementById('chatbotResponse').innerText = "Response from chatbot: No command recognized.";

            }

   
        }    
       };
   </script>
</body>
</html>